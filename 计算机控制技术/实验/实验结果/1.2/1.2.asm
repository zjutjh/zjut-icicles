CODE SEGMENT
ASSUME CS:CODE
START: MOV AX,OFFSET IRQ7
MOV SI,003CH
MOV [SI],AX
MOV AX,CS
MOV SI,003EH
MOV [SI],AX
CLI
CALL SYSINTI
MOV DX,0F043H
MOV AL,076H
OUT DX,AL
MOV DX,0F041H
MOV AL,10H
OUT DX,AL
MOV DX,0F041H
MOV AL,27H
OUT DX,AL
MOV BX,64H
MOV AH,01
MOV AL,13
INT 10H
AGAIN: STI
HLT
JMP AGAIN
IRQ7: DEC BX
JNZ FINISH
MOV BX,64H
MOV CX,001AH
MOV AL,41H
AGAIN1: MOV AH,01
INT 10H
INC AL
LOOP AGAIN1
MOV AH,01
MOV AL,13
INT 10H
FINISH: MOV AL,20H
OUT 20H,AL
IRET
SYSINTI:MOV AX,8000H ;系统初始化子程序
OUT 23H,AL ;扩展IO使能
XCHG AL,AH
OUT 22H,AL
OUT 22H,AX
MOV DX,0F822H ;初始化管脚配置P2CFG，配置CS0#
MOV AL,70H
OUT DX,AL
MOV DX,0F824H ;初始化管脚配置P3CFG,配置主片IRQ7
MOV AL,0B2H
OUT DX,AL
MOV DX,0F832H ;初始化管脚配置INTCFG
MOV AL,0AH
OUT DX,AL
MOV DX,0F834H ;初始化管脚配置TMRCFG
MOV AL,15H ;将GATE1接VCC
OUT DX,AL
MOV AL,11H ;初始化主片8259
OUT 20H,AL
MOV AL,08H
OUT 21H,AL
MOV AL,04H
OUT 21H,AL
MOV AL,01H
OUT 21H,AL
MOV AL,6FH ;写主片8259的中断屏蔽字，允许主片的IRQ7(用户
OUT 21H,AL
MOV AL,11H ;初始化从片8259
OUT 0A0H,AL
MOV AL,30H
OUT 0A1H,AL
MOV AL,02H
OUT 0A1H,AL
MOV AL,01H
OUT 0A1H,AL
MOV AL,0FFH
OUT 0A1H,AL
RET
CODE ENDS
END START